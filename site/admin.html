<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager - Admin</title>
    <!-- Quill.js WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- External Stylesheet -->
    <link rel="stylesheet" href="/admin.css?v=1.0">
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm" class="login-form">
        <h1>üîê Admin Login</h1>
        <form id="login">
            <input type="text" id="username" placeholder="Username" required autocomplete="username">
            <input type="password" id="password" placeholder="Password" required autocomplete="current-password">
            <button type="submit">Login</button>
            <div id="loginError" class="error"></div>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-container">
            <div class="header">
                <h1>üìÅ File Manager</h1>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('edit')">‚úèÔ∏è Edit Files</button>
                <button class="tab" onclick="switchTab('upload')">üì§ Upload Files</button>
            </div>

            <!-- Edit Files Tab -->
            <div id="editTab" class="tab-content active">
                <div class="file-browser">
                    <div class="file-browser-header">
                        <div class="file-browser-toolbar">
                            <button onclick="refreshFileList()" title="Refresh">üîÑ Refresh</button>
                            <button onclick="showCreateDirectoryDialog()" title="Create Directory">üìÅ New Folder</button>
                        </div>
                        <input type="text" id="fileSearch" class="file-search" placeholder="üîç Search files..." onkeyup="filterFiles()">
                    </div>
                    <div id="bulkActions" class="bulk-actions">
                        <span class="bulk-actions-info" id="bulkActionsInfo">0 files selected</span>
                        <div class="bulk-actions-buttons">
                            <button onclick="selectAllFiles()">Select All</button>
                            <button onclick="deselectAllFiles()">Deselect All</button>
                            <button class="delete" onclick="deleteSelectedFiles()">üóëÔ∏è Delete Selected</button>
                        </div>
                    </div>
                    <table class="file-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" id="selectAllCheckbox" class="file-checkbox" onchange="toggleSelectAll(this.checked)">
                                </th>
                                <th class="sortable" onclick="sortFiles('name')" id="sortName">Name</th>
                                <th class="sortable" onclick="sortFiles('path')" id="sortPath">Path</th>
                                <th class="sortable" onclick="sortFiles('type')" id="sortType">Type</th>
                                <th class="sortable" onclick="sortFiles('size')" id="sortSize">Size</th>
                                <th class="sortable" onclick="sortFiles('date')" id="sortDate">Modified</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fileTableBody">
                            <tr>
                                <td colspan="7" class="file-empty">Loading files...</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="file-stats">
                        <span id="fileCount">0 files</span>
                        <span id="totalSize">0 bytes</span>
                    </div>
                </div>
                <div id="editorContainer" class="editor-container" style="display: none;">
                    <div class="editor-header">
                        <h3 id="editorTitle"></h3>
                        <div class="editor-mode-toggle">
                            <button id="wysiwygModeBtn" class="active" onclick="switchEditorMode('wysiwyg')">WYSIWYG</button>
                            <button id="codeModeBtn" onclick="switchEditorMode('code')">Code</button>
                        </div>
                    </div>
                    <div id="wysiwygEditor" class="editor-wrapper"></div>
                    <textarea id="fileEditor" class="editor-wrapper" style="display: none;"></textarea>
                    <div class="keyboard-hint">
                        <span>Keyboard shortcuts: <kbd>Ctrl+S</kbd> to save, <kbd>Esc</kbd> to cancel</span>
                    </div>
                    <div class="editor-actions">
                        <button onclick="saveFile()">üíæ Save File</button>
                        <button class="secondary" onclick="cancelEdit()">Cancel</button>
                        <div id="saveIndicator" class="save-indicator"></div>
                    </div>
                    <div id="saveMessage" class="save-message"></div>
                </div>
            </div>

            <!-- Upload Files Tab -->
            <div id="uploadTab" class="tab-content">
                <div class="upload-form">
                    <h2>üì§ Upload Files or Directories</h2>
                    <p>Upload files or entire directories to replace or add to the site. If a file already exists, it will be replaced.</p>
                    
                    <div class="upload-mode-toggle">
                        <button id="fileModeBtn" class="active" onclick="switchUploadMode('files')">üìÑ Files</button>
                        <button id="directoryModeBtn" onclick="switchUploadMode('directory')">üìÅ Directory</button>
                    </div>
                    
                    <form id="uploadForm">
                        <input type="file" id="fileInput" multiple required>
                        <div id="uploadInfo" class="upload-info"></div>
                        <div id="targetDirectoryContainer" style="display: none; margin-top: 1rem;">
                            <label for="targetDirectory" style="display: block; margin-bottom: 0.5rem; color: rgba(255, 255, 255, 0.8); font-weight: 500;">
                                Target Directory Name (optional):
                            </label>
                            <input type="text" id="targetDirectory" class="file-search" 
                                   placeholder="e.g., imgs (leave empty to upload to root)" 
                                   style="margin: 0;">
                            <small style="display: block; margin-top: 0.5rem; color: rgba(255, 255, 255, 0.5); font-size: 0.85rem;">
                                If specified, files will be uploaded to /[directory-name]/ instead of root
                            </small>
                        </div>
                        <div id="directoryPreview" class="directory-preview" style="display: none;"></div>
                        <button type="submit">Upload</button>
                    </form>
                    <div id="uploadMessage" class="upload-message"></div>
                    <div id="uploadProgress" class="upload-progress" style="display: none;">
                        <div id="uploadStatus"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript -->
    <script src="/admin.js?v=1.0"></script>
</body>
</html>
